(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a0f7464a"],{"0722":function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));i("c120");var s=i("b2b2"),r=i("1c92"),n=i("8c71"),a=i("738e"),o=i("19db"),l=i("7c4b"),c=i("c8dd"),h=i("7ce4"),u=i("d17d"),d=i("0fa6");class f extends l["a"]{constructor(e=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.width=null,this.source=e}destroy(){var e,t;Object(s["j"])(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}get source(){return this._source}set source(e){this._source=e,this.invalidateVAO()}invalidateVAO(){var e,t;!this._vaoInvalidated&&Object(s["j"])(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,Object(s["j"])(this.source)&&!Object(s["j"])(this.vaoData)){const{style:t}=this.symbolizerParameters;switch(t){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const t=Object(o["d"])(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={magdir:i}}break;case"simple_scalar":{const t=Object(o["e"])(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={scalar:i}}break;case"wind_speed":{const t=Object(o["d"])(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t),s=Object(o["e"])(this.source,this.symbolizerParameters),r=this._createVectorFieldVAO(e.context,s);this.vaoData={magdir:i,scalar:r}}}}this.ready(),this.requestRender()}}_createTransforms(){return{dvs:Object(n["b"])()}}setTransform(e){const t=Object(r["b"])(this.transforms.dvs),[i,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),n=this.resolution/this.pixelRatio/e.resolution,o=n*this.width,l=n*this.height,c=Math.PI*this.rotation/180;Object(r["c"])(t,t,Object(a["b"])(i,s)),Object(r["c"])(t,t,Object(a["b"])(o/2,l/2)),Object(r["k"])(t,t,-c),Object(r["c"])(t,t,Object(a["b"])(-o/2,-l/2)),Object(r["g"])(t,t,Object(a["b"])(o,l)),Object(r["i"])(this.transforms.dvs,e.displayViewMat3,t)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(e,t){const{vertexData:i,indexData:s}=t,r=h["a"].createVertex(e,u["D"].STATIC_DRAW,new Float32Array(i)),n=h["a"].createIndex(e,u["D"].STATIC_DRAW,new Uint32Array(s)),a=Object(c["g"])("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:u["k"].FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:u["k"].FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:u["k"].FLOAT,normalized:!1}]});return{vao:new d["a"](e,a.attributes,a.bufferLayouts,{geometry:r},n),elementCount:s.length}}}},"19db":function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return y})),i.d(t,"d",(function(){return V})),i.d(t,"e",(function(){return I})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return C})),i.d(t,"h",(function(){return g})),i.d(t,"i",(function(){return h})),i.d(t,"j",(function(){return f}));var s=i("fa8a"),r=i("b2b2"),n=i("3e27"),a=i("9dee");const o=new Map;o.set("meter-per-second",1),o.set("kilometer-per-hour",.277778),o.set("knots",.514444),o.set("feet-per-second",.3048),o.set("mile-per-hour",.44704);const l=180/Math.PI,c=5,h=new s["a"]({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function u(e,t){return o.get(e)/o.get(t)||1}function d(e){return(450-e)%360}function f(e,t="geographic"){const[i,s]=e,r=Math.sqrt(i*i+s*s);let n=Math.atan2(s,i)*l;return n=(360+n)%360,"geographic"===t&&(n=d(n)),[r,n]}function p(e,t="geographic"){let i=e[1];"geographic"===t&&(i=d(i)),i%=360;const s=e[0];return[s*Math.cos(i/l),s*Math.sin(i/l)]}function m(e,t,i,s="geographic"){if(!Object(a["j"])(e)||Object(r["i"])(i))return e;const n="vector-magdir"===t?e.clone():Object(r["q"])(b(e,t)),o=n.pixels[1];for(let r=0;r<o.length;r++)o[r]="geographic"===s?(o[r]+i[r]+270)%360:(o[r]+360-i[r])%360;return"vector-magdir"===t?n:b(n,"vector-magdir")}function b(e,t,i="geographic",s=1){if(!Object(a["j"])(e))return e;const{pixels:r,width:o,height:l}=e,c=o*l,h=r[0],u=r[1],d=e.pixelType.startsWith("f")?e.pixelType:"f32",m=n["a"].createEmptyBand(d,c),b=n["a"].createEmptyBand(d,c);let y=0;for(let n=0;n<l;n++)for(let e=0;e<o;e++)"vector-uv"===t?([m[y],b[y]]=f([h[y],u[y]],i),m[y]*=s):([m[y],b[y]]=p([h[y],u[y]],i),m[y]*=s,b[y]*=s),y++;const g=new n["a"]({pixelType:d,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[m,b]});return g.updateStatistics(),g}function y(e,t,i=1){if(1===i||!Object(a["j"])(e))return e;const s=e.clone(),{pixels:r,width:n,height:o}=s,l=r[0],c=r[1];let h=0;for(let a=0;a<o;a++)for(let e=0;e<n;e++)"vector-uv"===t?(l[h]*=i,c[h]*=i):l[h]*=i,h++;return s.updateStatistics(),s}function g(e,t,i,s,n){if(!Object(r["j"])(n)||!n.spatialReference.equals(e.spatialReference))return{extent:e,width:Math.round(t/s),height:Math.round(i/s),resolution:e.width/t};const a=n.xmin,o=n.ymax,l=(e.xmax-e.xmin)/t*s,c=(e.ymax-e.ymin)/i*s,h=(l+c)/2;return e.xmin=a+Math.floor((e.xmin-a)/l)*l,e.xmax=a+Math.ceil((e.xmax-a)/l)*l,e.ymin=o+Math.floor((e.ymin-o)/c)*c,e.ymax=o+Math.ceil((e.ymax-o)/c)*c,{extent:e,width:Math.round(e.width/l),height:Math.round(e.height/c),resolution:h}}const x=w(0,0,0);function w(e=0,t=0,i=Math.PI,s=!0){s&&(i=(2*Math.PI-i)%(2*Math.PI));const r=s?-1:1,n=13*r,a=-7*r,o=-2*r,l=-16*r,c=21.75,[h,u]=v(0,t+n,i,c),[d,f]=v(e-5.5,t+a,i,c),[p,m]=v(e+5.5,t+a,i,c),[b,y]=v(e-1.5,t+o,i,c),[g,x]=v(e+1.5,t+o,i,c),[w,_]=v(e-1.5,t+l,i,c),[O,j]=v(e+1.5,t+l,i,c);return[h,u,d,f,b,y,g,x,p,m,w,_,O,j]}function _(e=0,t=Math.PI,i=!0){i&&(t=(2*Math.PI-t)%(2*Math.PI));const s=10,r=i?-1:1,n=5*r,a=20*r,o=25*r,l=45,h=0,u=0,d=2,f=0,p=d*r;let[m,b]=[h+s/2,u-a],[y,g]=[m+d,b],[x,w]=[y-f,g+p],[_,O]=[h-s/2,u-o],[j,S]=[_+f,O-p],P=Math.ceil(e/c),R=Math.floor(P/10);P-=8*R;const M=[],k=[];for(let c=0;c<P/2;c++,R--){R<=0&&P%2==1&&c===(P-1)/2&&(_=h,j=_+f,O=(O+b)/2,S=O-p);const[e,i]=v(_,O,t,l);if(R>0){const[s,r]=v(y,O,t,l),[n,a]=v(m,b,t,l);M.push(s),M.push(r),M.push(e),M.push(i),M.push(n),M.push(a)}else{const[s,r]=v(y,g,t,l),[n,a]=v(x,w,t,l),[o,c]=v(j,S,t,l);k.push(e),k.push(i),k.push(o),k.push(c),k.push(n),k.push(a),k.push(s),k.push(r)}O+=n,b+=n,g+=n,w+=n,S+=n}const[T,I]=v(h+s/2,u+a,t,l),V=s/2+d,[C,D]=v(h+V,u+a,t,l),[z,F]=v(h+s/2,u-o,t,l),[E,L]=v(h+V,u-o,t,l);return{pennants:M,barbs:k,shaft:[T,I,C,D,z,F,E,L]}}function v(e,t,i,s=1){const r=Math.sqrt(e*e+t*t)/s,n=(2*Math.PI+Math.atan2(t,e))%(2*Math.PI);return[r,(2*Math.PI+n-i)%(2*Math.PI)]}const O=[0,1,3,6,10,16,21,27,33,40,47,55,63],j=[0,.5,1,1.5,2],S=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function P(e,t,i,s){const r=u(s||"knots",i);let n;for(n=1;n<t.length;n++)if(n===t.length-1){if(e<t[n]*r)break}else if(e<=t[n]*r)break;return Math.min(n-1,t.length-2)}function R(e,t,i,s,r){let n=0;switch(t){case"beaufort_kn":n=P(e,O,"knots",i);break;case"beaufort_km":n=P(e,O,"kilometer-per-hour",i);break;case"beaufort_ft":n=P(e,O,"feet-per-second",i);break;case"beaufort_m":n=P(e,O,"meter-per-second",i);break;case"classified_arrow":n=P(e,r,s,i);break;case"ocean_current_m":n=P(e,j,"meter-per-second",i);break;case"ocean_current_kn":n=P(e,S,"knots",i)}return n}function M(e,t){const{style:i,inputUnit:s,outputUnit:r,breakValues:n}=t,a=h.fromJSON(s),o=h.fromJSON(r),l=42,c=15;let u=0,d=0;const{width:f,height:p,mask:m}=e,b=e.pixels[0],y=e.pixels[1],g=m?m.filter(e=>e>0).length:f*p,w=new Float32Array(g*l),_=new Uint32Array(c*g);for(let h=0;h<p;h++)for(let e=0;e<f;e++){const t=h*f+e;if(!m||m[h*f+e]){var v;const s=null!=(v=(y[t]+360)%360/180*Math.PI)?v:2*Math.PI*Math.random(),r=R(b[t],i,a,o,n);for(let i=0;i<x.length;i+=2)w[u++]=(e+.5)/f,w[u++]=(h+.5)/p,w[u++]=x[i],w[u++]=x[i+1]+s,w[u++]=r,w[u++]=b[t];const c=7*(u/l-1);_[d++]=c,_[d++]=c+1,_[d++]=c+2,_[d++]=c+0,_[d++]=c+4,_[d++]=c+3,_[d++]=c+0,_[d++]=c+2,_[d++]=c+3,_[d++]=c+2,_[d++]=c+5,_[d++]=c+3,_[d++]=c+5,_[d++]=c+6,_[d++]=c+3}}return{vertexData:w,indexData:_}}const k=[];function T(e,t){if(0===k.length)for(let c=0;c<30;c++)k.push(_(5*c,0));const i=u(h.fromJSON(t.inputUnit),"knots"),{width:s,height:r,mask:n}=e,a=e.pixels[0],o=e.pixels[1],l=6,d=[],f=[];let p=0,m=0;for(let h=0;h<r;h++)for(let e=0;e<s;e++){const t=h*s+e,u=a[t]*i;if((!n||n[h*s+e])&&u>=c){var b;const i=null!=(b=(o[t]+360)%360/180*Math.PI)?b:2*Math.PI*Math.random(),{pennants:n,barbs:a,shaft:c}=k[Math.min(Math.floor(u/5),29)];if(n.length+a.length===0)continue;let y=d.length/l;const g=(e+.5)/s,x=(h+.5)/r;for(let e=0;e<n.length;e+=2)d[p++]=g,d[p++]=x,d[p++]=n[e],d[p++]=n[e+1]+i,d[p++]=0,d[p++]=u;for(let e=0;e<a.length;e+=2)d[p++]=g,d[p++]=x,d[p++]=a[e],d[p++]=a[e+1]+i,d[p++]=0,d[p++]=u;for(let e=0;e<c.length;e+=2)d[p++]=g,d[p++]=x,d[p++]=c[e],d[p++]=c[e+1]+i,d[p++]=0,d[p++]=u;for(let e=0;e<n.length/6;e++)f[m++]=y,f[m++]=y+1,f[m++]=y+2,y+=3;for(let e=0;e<a.length/8;e++)f[m++]=y,f[m++]=y+1,f[m++]=y+2,f[m++]=y+1,f[m++]=y+2,f[m++]=y+3,y+=4;f[m++]=y+0,f[m++]=y+1,f[m++]=y+2,f[m++]=y+1,f[m++]=y+3,f[m++]=y+2,y+=4}}return{vertexData:new Float32Array(d),indexData:new Uint32Array(f)}}function I(e,t){const i=24;let s=0,r=0;const{width:n,height:a,mask:o}=e,l=e.pixels[0],d=[],f=[],p=u(h.fromJSON(t.inputUnit),"knots"),m="wind_speed"===t.style?c:Number.MAX_VALUE;for(let c=0;c<a;c++)for(let e=0;e<n;e++){const t=l[c*n+e]*p;if((!o||o[c*n+e])&&t<m){for(let i=0;i<4;i++)d[s++]=(e+.5)/n,d[s++]=(c+.5)/a,d[s++]=i<2?-.5:.5,d[s++]=i%2==0?-.5:.5,d[s++]=0,d[s++]=t;const o=4*(s/i-1);f[r++]=o,f[r++]=o+1,f[r++]=o+2,f[r++]=o+1,f[r++]=o+2,f[r++]=o+3}}return{vertexData:new Float32Array(d),indexData:new Uint32Array(f)}}function V(e,t){return"simple_scalar"===t.style?I(e,t):"wind_speed"===t.style?T(e,t):M(e,t)}function C(e,t,i,s=[0,0],r=.5){const{width:a,height:o,mask:l}=e,[c,h]=e.pixels,[u,d]=s,m=Math.round((a-u)/i),b=Math.round((o-d)/i),y=m*b,g=new Float32Array(y),x=new Float32Array(y),w=new Uint8Array(y),_="vector-uv"===t;for(let n=0;n<b;n++)for(let e=0;e<m;e++){let t=0;const s=n*m+e,b=Math.max(0,n*i+d),y=Math.max(0,e*i+u),v=Math.min(o,b+i),O=Math.min(a,y+i);for(let e=b;e<v;e++)for(let i=y;i<O;i++){const r=e*a+i;if(!l||l[r]){t++;const e=_?[c[r],h[r]]:[c[r],(360+h[r])%360],[i,n]=_?e:p(e);g[s]+=i,x[s]+=n}}if(t>=(v-b)*(O-y)*(1-r)){w[s]=1;const[e,i]=f([g[s]/t,x[s]/t]);g[s]=e,x[s]=i}else w[s]=0,g[s]=0,x[s]=0}const v=new n["a"]({width:m,height:b,pixels:[g,x],mask:w});return v.updateStatistics(),v}},"218c":function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return h})),i.d(t,"g",(function(){return u})),i.d(t,"h",(function(){return y}));i("e06a");var s=i("b2b2");class r{constructor(e=15e3,t=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}decreaseRefCount(e,t){const i=e+"/"+t,s=this._cachedBlocks;if(s.has(i)){const e=s.get(i);return e.refCount--,e.refCount<=0&&(s.delete(i),e.controller&&e.controller.abort()),e.refCount}return 0}getBlock(e,t){const i=e+"/"+t,s=this._cachedBlocks;if(s.has(i)){const e=s.get(i);return e.ts=Date.now(),e.refCount++,s.delete(i),s.set(i,e),e.block}return null}putBlock(e,t,i,s=null){const r=this._cachedBlocks,n=e+"/"+t;if(r.has(n)){const e=r.get(n);e.ts=Date.now(),e.refCount++}else r.set(n,{block:i,ts:Date.now(),refCount:1,controller:s});this._trim(),this._updateTimer()}deleteBlock(e,t){const i=this._cachedBlocks,s=e+"/"+t;i.has(s)&&i.delete(s)}updateMaxSize(e){this._size=e,this._trim()}empty(){this._cachedBlocks.clear(),this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null!=this._timer)return;const e=this._cachedBlocks;this._timer=setInterval(()=>{const t=Array.from(e),i=Date.now();for(let s=0;s<t.length&&t[s][1].ts<=i-this._duration;s++)e.delete(t[s][0]);0===e.size&&this._clearTimer()},this._interval)}_trim(){const e=this._cachedBlocks;if(-1===this._size||this._size>=e.size)return;const t=Array.from(e);for(let i=0;i<t.length-this._size;i++)e.delete(t[i][0])}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}var n=i("b4e0"),a=i("4ae5");const o=new Map,l=new r;function c(e,t){return null==t?e:`${e}?sliceId=${t}`}function h(e,t){const i={extent:null,rasterInfo:t,cache:new Map};if(o.has(e)){const t=o.get(e);return t.push(i),t.length-1}return o.set(e,[i]),0}function u(e,t){if(o.has(e)){const i=o.get(e);i[t]=null,i.some(e=>null!=e)||o.delete(e)}}function d(e,t,i){if(!o.has(e))return null==t?l.decreaseRefCount(e,i):0;const s=o.get(e);if(null==s[t])return l.decreaseRefCount(e,i);const r=s[t].cache;if(r.has(i)){const e=r.get(i);if(e.refCount--,0===e.refCount){r.delete(i);for(let e=0;e<s.length;e++)s[e]&&s[e].cache.has(i)&&s[e].cache.delete(i);e.controller&&e.controller.abort()}return e.refCount}return 0}function f(e,t,i){if(!o.has(e))return null==t?l.getBlock(e,i):null;const s=o.get(e);if(null==s[t]){for(let e=0;e<s.length;e++)if(s[e]&&s[e].cache.has(i)){const t=s[e].cache.get(i);return t.refCount++,t.block}return l.getBlock(e,i)}const r=s[t].cache;if(r.has(i)){const e=r.get(i);return e.refCount++,e.block}for(let n=0;n<s.length;n++)if(n!==t&&s[n]&&s[n]&&s[n].cache.has(i)){const e=s[n].cache.get(i);return e.refCount++,r.set(i,e),e.block}return null}function p(e,t,i,s,r=null){if(!o.has(e))return void(null==t&&l.putBlock(e,i,s,r));const n=o.get(e);if(null==n[t])return void l.putBlock(e,i,s,r);const a={refCount:1,block:s,isResolved:!1,isRejected:!1,controller:r};s.then(()=>a.isResolved=!0).catch(()=>a.isRejected=!0),n[t].cache.set(i,a)}function m(e,t,i){if(!o.has(e))return void(null==t&&l.deleteBlock(e,i));const s=o.get(e);null!=s[t]?s[t].cache.delete(i):l.deleteBlock(e,i)}function b(e,t){if(!o.has(e))return null;const i=o.get(e);return null==i[t]?null:i[t]}function y(e,t,i,r,o,l,c=null){const h=b(e,t),u=h.extent,{cache:d,rasterInfo:f}=h;if(u&&u.xmin===i.xmin&&u.xmax===i.xmax&&u.ymin===i.ymin&&u.ymax===i.ymax)return;const p=i.clone().normalize(),{spatialReference:m,transform:y}=f,g=new Set;for(let b=0;b<p.length;b++){const e=p[b];if(e.xmax-e.xmin<=r||e.ymax-e.ymin<=r)continue;let t=Object(n["h"])(e,m,c);Object(s["j"])(y)&&(t=y.inverseTransform(t));const i=new a["a"]({x:r,y:r,spatialReference:e.spatialReference});if(null==o&&!(o=Object(n["j"])(i,m,e,c)))return;const{pyramidLevel:h,pyramidResolution:u,excessiveReading:d}=Object(n["m"])(o,f,l||"closest");if(d)return;const{storageInfo:x}=f,{origin:w}=x,_={x:Math.max(0,Math.floor((t.xmin-w.x)/u.x)),y:Math.max(0,Math.floor((w.y-t.ymax)/u.y))},v=Math.ceil((t.xmax-t.xmin)/u.x-.1),O=Math.ceil((t.ymax-t.ymin)/u.y-.1),j=h>0?x.pyramidBlockWidth:x.blockWidth,S=h>0?x.pyramidBlockHeight:x.blockHeight,P=1,R=Math.max(0,Math.floor(_.x/j)-P),M=Math.max(0,Math.floor(_.y/S)-P),k=Math.floor((_.x+v-1)/j)+P,T=Math.floor((_.y+O-1)/S)+P;for(let s=M;s<=T;s++)for(let e=R;e<=k;e++)g.add(`${h}/${s}/${e}`)}d.forEach((e,t)=>{if(!g.has(t)){const e=d.get(t);(null==e||e.isResolved||e.isRejected)&&d.delete(t)}}),h.extent={xmin:i.xmin,ymin:i.ymin,xmax:i.xmax,ymax:i.ymax}}},2616:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return w}));i("e06a");var s=i("e92d"),r=i("38a4"),n=i("b2b2"),a=i("f4cc"),o=i("880d"),l=i("7f83"),c=i("3af1");const h=s["a"].getLogger("esri.views.2d.engine.flow.dataUtils"),u=9;async function d(e,t,i){const s=performance.now(),r=f(e,t),n=performance.now(),o=m(e,r,t.width,t.height),l=performance.now(),c=y(o,!0),u=performance.now(),d=g(c),p=performance.now();if(e.profile){const e={"_createFlowFieldFromData()":Math.round(n-s),"_getStreamlines()":Math.round(l-n),"createAnimatedLinesData()":Math.round(u-l),"createLinesMesh()":Math.round(p-u),"Total elapsed time":Math.round(p-s)};h.info("createStreamlinesMesh profile",e)}return await Promise.resolve(),Object(a["t"])(i),d}function f(e,t){const i=b(t.data,t.width,t.height,e.smoothing);return e.interpolate?(e,s)=>{const r=Math.floor(e),n=Math.floor(s);if(r<0||r>=t.width)return[0,0];if(n<0||n>=t.height)return[0,0];const a=e-r,o=s-n,l=r,c=n,h=r<t.width-1?r+1:r,u=n<t.height-1?n+1:n,d=i[2*(c*t.width+l)],f=i[2*(c*t.width+h)],p=i[2*(u*t.width+l)],m=i[2*(u*t.width+h)],b=i[2*(c*t.width+l)+1],y=i[2*(c*t.width+h)+1];return[(d*(1-o)+p*o)*(1-a)+(f*(1-o)+m*o)*a,(b*(1-o)+i[2*(u*t.width+l)+1]*o)*(1-a)+(y*(1-o)+i[2*(u*t.width+h)+1]*o)*a]}:(e,s)=>{const r=Math.round(e),n=Math.round(s);return r<0||r>=t.width||n<0||n>=t.height?[0,0]:[i[2*(n*t.width+r)+0],i[2*(n*t.width+r)+1]]}}function p(e,t,i,s,r,n,a,o,l){const c=[];let h=i,u=s,d=0,[f,p]=t(h,u);f*=e.velocityScale,p*=e.velocityScale;const m=Math.sqrt(f*f+p*p);let b,y;c.push({x:h,y:u,t:d,speed:m});for(let g=0;g<e.verticesPerLine;g++){let[i,s]=t(h,u);i*=e.velocityScale,s*=e.velocityScale;const f=Math.sqrt(i*i+s*s);if(f<e.minSpeedThreshold)return c;const p=i/f,m=s/f;if(h+=p*e.segmentLength,u+=m*e.segmentLength,d+=e.segmentLength/f,Math.acos(p*b+m*y)>e.maxTurnAngle)return c;if(e.mergeLines){const e=Math.round(h*l),t=Math.round(u*l);if(e<0||e>a-1||t<0||t>o-1)return c;const i=n[t*a+e];if(-1!==i&&i!==r)return c;n[t*a+e]=r}c.push({x:h,y:u,t:d,speed:f}),b=p,y=m}return c}function m(e,t,i,s){const r=[],n=new o["a"],a=1/Math.max(e.lineCollisionWidth,1),l=Math.round(i*a),c=Math.round(s*a),h=new Int32Array(l*c);for(let o=0;o<h.length;o++)h[o]=-1;const u=[];for(let o=0;o<s;o+=e.lineSpacing)for(let t=0;t<i;t+=e.lineSpacing)u.push({x:t,y:o,sort:n.getFloat()});u.sort((e,t)=>e.sort-t.sort);for(const{x:o,y:d}of u)if(n.getFloat()<e.density){const i=p(e,t,o,d,r.length,h,l,c,a);if(i.length<2)continue;r.push(i)}return r}function b(e,t,i,s){if(0===s)return e;const r=Math.round(3*s),n=new Array(2*r+1);let a=0;for(let c=-r;c<=r;c++){const e=Math.exp(-c*c/(s*s));n[c+r]=e,a+=e}for(let c=-r;c<=r;c++)n[c+r]/=a;const o=new Float32Array(e.length);for(let c=0;c<i;c++)for(let i=0;i<t;i++){let s=0,a=0;for(let o=-r;o<=r;o++){if(i+o<0||i+o>=t)continue;const l=n[o+r];s+=l*e[2*(c*t+(i+o))+0],a+=l*e[2*(c*t+(i+o))+1]}o[2*(c*t+i)+0]=s,o[2*(c*t+i)+1]=a}const l=new Float32Array(e.length);for(let c=0;c<t;c++)for(let e=0;e<i;e++){let s=0,a=0;for(let l=-r;l<=r;l++){if(e+l<0||e+l>=i)continue;const h=n[l+r];s+=h*o[2*((e+l)*t+c)+0],a+=h*o[2*((e+l)*t+c)+1]}l[2*(e*t+c)+0]=s,l[2*(e*t+c)+1]=a}return l}function y(e,t){const i=new o["a"],s=e.reduce((e,t)=>e+t.length,0),r=new Float32Array(4*s),n=new Array(e.length);let a=0,l=0;for(const o of e){const e=a;for(const t of o)r[4*a+0]=t.x,r[4*a+1]=t.y,r[4*a+2]=t.t,r[4*a+3]=t.speed,a++;n[l++]={startVertex:e,numberOfVertices:o.length,totalTime:o[o.length-1].t,timeSeed:t?i.getFloat():0}}return{lineVertices:r,lineDescriptors:n}}function g(e,t=10){const{lineVertices:i,lineDescriptors:s}=e;let r=0,n=0;for(const u of s)r+=2*u.numberOfVertices,n+=6*(u.numberOfVertices-1);const a=new Float32Array(r*u),o=new Uint32Array(n);let l=0,c=0;function h(){o[c++]=l-2,o[c++]=l,o[c++]=l-1,o[c++]=l,o[c++]=l+1,o[c++]=l-1}function d(e,t,i,s,r,n,o,c){const h=l*u;let d=0;a[h+d++]=e,a[h+d++]=t,a[h+d++]=1,a[h+d++]=i,a[h+d++]=n,a[h+d++]=o,a[h+d++]=s/2,a[h+d++]=r/2,a[h+d++]=c,l++,a[h+d++]=e,a[h+d++]=t,a[h+d++]=-1,a[h+d++]=i,a[h+d++]=n,a[h+d++]=o,a[h+d++]=-s/2,a[h+d++]=-r/2,a[h+d++]=c,l++}for(const u of s){const{totalTime:e,timeSeed:s}=u;let r=null,n=null,a=null,o=null,l=null,c=null;for(let f=0;f<u.numberOfVertices;f++){const p=i[4*(u.startVertex+f)+0],m=i[4*(u.startVertex+f)+1],b=i[4*(u.startVertex+f)+2],y=i[4*(u.startVertex+f)+3];let g=null,x=null,w=null,_=null;if(f>0){g=p-r,x=m-n;const i=Math.sqrt(g*g+x*x);if(g/=i,x/=i,f>1){let e=g+l,i=x+c;const s=Math.sqrt(e*e+i*i);e/=s,i/=s;const r=Math.min(1/(e*g+i*x),t);e*=r,i*=r,w=-i,_=e}else w=-x,_=g;null!==w&&null!==_&&(d(r,n,a,w,_,e,s,y),h())}r=p,n=m,a=b,l=g,c=x,o=y}d(r,n,a,-c,l,e,s,o)}return{vertexData:a,indexData:o}}function x(e,t){const i=t.pixels,{width:s,height:n}=t,a=new Float32Array(s*n*2);if("vector-uv"===e)for(let r=0;r<s*n;r++)a[2*r+0]=i[0][r],a[2*r+1]=-i[1][r];else if("vector-magdir"===e)for(let o=0;o<s*n;o++){const e=i[0][o],t=Object(r["g"])(i[1][o]),s=Math.cos(t-Math.PI/2),n=Math.sin(t-Math.PI/2);a[2*o+0]=s*e,a[2*o+1]=n*e}return{data:a,width:s,height:n}}async function w(e,t,i,s,r,n){const a=Object(l["e"])(t.spatialReference);if(!a)return _(e,t,i,s,r,n);const[o,h]=a.valid,u=h-o,d=Math.ceil(t.width/u),f=t.width/d,p=Math.round(i/d);let m=t.xmin;const b=[];for(let l=0;l<d;l++){const i=new c["a"]({xmin:m,xmax:m+f,ymin:t.ymin,ymax:t.ymax,spatialReference:t.spatialReference});b.push(_(e,i,p,s,r,n)),m+=f}const y=await Promise.all(b),g={data:new Float32Array(i*s*2),width:i,height:s};let x=0;for(const l of y){for(let e=0;e<l.height;e++)for(let t=0;t<l.width;t++)x+t>=i||(g.data[2*(e*i+x+t)+0]=l.data[2*(e*l.width+t)+0],g.data[2*(e*i+x+t)+1]=l.data[2*(e*l.width+t)+1]);x+=l.width}return g}async function _(e,t,i,s,r,a){const o={requestProjectedLocalDirections:!0,signal:a};if(Object(n["j"])(r)&&(o.timeExtent=r),"imagery"===e.type){await e.load({signal:a});const r=e.rasterInfo.dataType,l=await e.fetchImage(t,i,s,o);return!l||Object(n["i"])(l.pixelData)||Object(n["i"])(l.pixelData.pixelBlock)?{data:new Float32Array(i*s*2),width:i,height:s}:x(r,l.pixelData.pixelBlock)}await e.load({signal:a});const l=e.rasterInfo.dataType,c=await e.fetchPixels(t,i,s,o);return!c||Object(n["i"])(c.pixelBlock)?{data:new Float32Array(i*s*2),width:i,height:s}:x(l,c.pixelBlock)}},"45a5":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var s=i("fa8a");const r=new s["a"]({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function n(e){return r.toJSON(e)}function a(e){const{bandCount:t,attributeTable:i,colormap:s,pixelType:r}=e.rasterInfo;return 1===t&&(null!=i||null!=s||"u8"===r||"s8"===r)}},6722:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var s=i("c120"),r=i("c84e"),n=i("9a02"),a=i("6f75"),o=i("ec5e");const l=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;class c extends n["a"]{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(l),this.setStencilReference(e),super.renderChildren(e)}createRenderParams(e){const{state:t}=e,i=super.createRenderParams(e);return i.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,i.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),i}prepareRenderPasses(e){const t=super.prepareRenderPasses(e);return t.push(e.registerRenderPass({name:"stencil",brushes:[o["a"]],drawPhase:r["c"].DEBUG|r["c"].MAP|r["c"].HIGHLIGHT,target:()=>this.getStencilTarget()})),Object(s["a"])("esri-tiles-debug")&&t.push(e.registerRenderPass({name:"tileInfo",brushes:[a["a"]],drawPhase:r["c"].DEBUG,target:()=>this.children})),t}getStencilTarget(){return this.children}updateTransforms(e){for(const t of this.children){const i=this._tileInfoView.getTileResolution(t.key);t.setTransform(e,i)}}setStencilReference(e){let t=1;for(const i of this.children)i.stencilRef=t++}}},"6c7a":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var s=i("a4ee"),r=i("e92d"),n=i("f4cc"),a=i("477c"),o=i("59b2"),l=(i("b50f"),i("c120"),i("cea0"),i("d386"));const c=e=>{let t=class extends e{initialize(){this.handles.add(Object(a["b"])(()=>this.layer,"refresh",e=>{this.doRefresh(e.dataChanged).catch(e=>{Object(n["l"])(e)||r["a"].getLogger(this.declaredClass).error(e)})}),"RefreshableLayerView")}};return Object(s["a"])([Object(o["b"])()],t.prototype,"layer",void 0),t=Object(s["a"])([Object(l["a"])("esri.layers.mixins.RefreshableLayerView")],t),t}},"870c":function(e,t,i){"use strict";i.d(t,"a",(function(){return H}));var s=i("a4ee"),r=i("8d60"),n=i("9096"),a=i("477c"),o=i("59b2"),l=(i("b50f"),i("c120"),i("cea0"),i("d386")),c=i("2616"),h=i("c9ee"),u=i("c84e"),d=i("9a02");class f extends d["a"]{constructor(){super(...arguments),this.flowStyle=null}get requiresDedicatedFBO(){return!1}doRender(e){super.doRender(e)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"flow",brushes:[h["a"]],target:()=>this.children,drawPhase:u["c"].MAP});return[...super.prepareRenderPasses(e),t]}}i("e06a");var p=i("fc29"),m=i("e92d"),b=i("38a4"),y=i("b2b2"),g=i("f4cc"),x=i("4ae5");const w=m["a"].getLogger("esri.views.2d.engine.flow.FlowDisplayData");class _{constructor(e,t,i,s){this.state={name:"created"},this.flowStyle=e,this.extent=t,this.size=i,this.pixelRatio=s}async load(){const e=new AbortController;this.state={name:"loading",abortController:e};const t=await this.flowStyle.loadResources({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},e.signal);this.state={name:"loaded",resources:t}}prepareForRendering(e){if("loaded"!==this.state.name)return void w.error("Only loaded resources can be attached.");const t=this.state.resources;t.prepareForRendering(e),this.state={name:"attached",resources:t}}destroy(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(e){return!!this.flowStyle.areResourcesCompatible(e.flowStyle)&&(!(!this.extent.equals(e.extent)||this.size[0]!==e.size[0]||this.size[1]!==e.size[1]||this.pixelRatio!==e.pixelRatio)&&(this.flowStyle=e.flowStyle,!0))}}var v=i("1c92"),O=i("8c71"),j=i("7c4b");class S extends j["a"]{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(e){this._displayData=e,this.requestRender()}clear(){Object(y["j"])(this._displayData)&&(this._displayData.destroy(),this._displayData=null,this.requestRender())}setTransform(e){const{displayData:t}=this;if(Object(y["i"])(t))return;const i=t.extent.xmin,s=t.extent.ymax,r=[0,0];e.toScreen(r,[i,s]);const n=(t.extent.xmax-t.extent.xmin)/t.size[0]/e.resolution,a=Object(b["g"])(e.rotation),{dvs:o}=this.transforms;Object(v["h"])(o,[-1,1,0]),Object(v["d"])(o,o,[2/(e.size[0]*e.pixelRatio),-2/(e.size[1]*e.pixelRatio),1]),Object(v["c"])(o,o,[r[0],r[1],0]),Object(v["k"])(o,o,a),Object(v["d"])(o,o,[n*e.pixelRatio,n*e.pixelRatio,1])}_createTransforms(){return{dvs:Object(O["b"])()}}}var P=i("3af1");const R=1.15,M=m["a"].getLogger("esri.views.2d.engine.flow.FlowStrategy");let k=class extends p["a"]{constructor(e){super(e),this._flowDisplayObject=new S,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(e){const{flowStyle:t}=this.flowContainer;if(Object(y["i"])(t))return void this._clear();const{extent:i,rotation:s,resolution:r,pixelRatio:n}=e.state,a=I(i,s);a.expand(R);const o=[Math.round((a.xmax-a.xmin)/r),Math.round((a.ymax-a.ymin)/r)],l=new _(t,a,o,n);if(Object(y["j"])(this._loading)){if(this._loading.update(l))return;this._loading.destroy(),this._loading=null}!Object(y["i"])(this._flowDisplayObject.displayData)&&this._flowDisplayObject.displayData.update(l)||(l.load().then(()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null},e=>{Object(g["l"])(e)||(M.error("A resource failed to load.",e),this._loading=null)}),this._loading=l)}_clear(){this._flowDisplayObject.clear(),Object(y["j"])(this._loading)&&(this._loading.destroy(),this._loading=null)}};Object(s["a"])([Object(o["b"])()],k.prototype,"_loading",void 0),Object(s["a"])([Object(o["b"])()],k.prototype,"flowContainer",void 0),Object(s["a"])([Object(o["b"])()],k.prototype,"updating",null),k=Object(s["a"])([Object(l["a"])("esri.views.2d.engine.flow.FlowStrategy")],k);const T=k;function I(e,t){const i=new x["a"]({x:(e.xmax+e.xmin)/2,y:(e.ymax+e.ymin)/2,spatialReference:e.spatialReference}),s=e.xmax-e.xmin,r=e.ymax-e.ymin,n=Math.abs(Math.cos(Object(b["g"])(t))),a=Math.abs(Math.sin(Object(b["g"])(t))),o=n*s+a*r,l=a*s+n*r,c=new P["a"]({xmin:i.x-o/2,ymin:i.y-l/2,xmax:i.x+o/2,ymax:i.y+l/2,spatialReference:e.spatialReference});return c.centerAt(i),c}var V=i("7ce4"),C=i("d17d"),D=i("0fa6"),z=i("3f3e");const F=new Map;F.set("a_positionAndSide",0),F.set("a_timeInfo",1),F.set("a_extrude",2),F.set("a_speed",3);const E={geometry:[new z["a"]("a_positionAndSide",3,C["k"].FLOAT,0,36),new z["a"]("a_timeInfo",3,C["k"].FLOAT,12,36),new z["a"]("a_extrude",2,C["k"].FLOAT,24,36),new z["a"]("a_speed",1,C["k"].FLOAT,32,36)]};class L{constructor(e,t,i){this.values=i,this._vertexData=e,this._indexData=t}prepareForRendering(e){const t=V["a"].createVertex(e,C["D"].STATIC_DRAW,this._vertexData),i=V["a"].createIndex(e,C["D"].STATIC_DRAW,this._indexData),s=new D["a"](e,F,E,{geometry:t},i);this.vertexBuffer=t,this.indexBuffer=i,this.vertexArray=s,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose(),this.vertexBuffer.dispose(),this.indexBuffer.dispose()}get locations(){return F}}var A=i("a915");function G(e){const t=W(e),i=U(t),s=2*i,r=Math.round(Object(A["c"])(e.maxPathLength)/s)+1,n=i,a=10,o=q(e),l=N(e),{flowSpeed:c,trailLength:h,density:u}=e;return{lineRenderWidth:t,segmentLength:s,verticesPerLine:r,lineCollisionWidth:n,lineSpacing:a,lineColor:o,lineOpacity:l,lineSpeed:c,fadeDuration:h,density:u,smoothing:Object(A["c"])(e.smoothing),velocityScale:"flow-from"===e.flowRepresentation?1:-1,minWeightThreshold:.001,minSpeedThreshold:.001,maxTurnAngle:1,mergeLines:!0,interpolate:!0,profile:!1}}function U(e){return"constant"===e.kind?e.value[0]:e.values[e.values.length-1]}function B(e){const t=e.toRgba();return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function W(e){if(!e.hasVisualVariables("size"))return{kind:"constant",value:[Object(A["c"])(e.trailWidth)]};const t=e.getVisualVariablesForType("size")[0],i=[],s=[];let r;if(t.stops){for(const e of t.stops)i.push(e.value),s.push(e.size);r=t.stops.length}else i.push(t.minDataValue,t.maxDataValue),s.push(t.minSize,t.maxSize),r=2;return{kind:"ramp",stops:i,values:s,count:r}}function q(e){if(!e.hasVisualVariables("color"))return{kind:"constant",value:B(e.color)};const t=e.getVisualVariablesForType("color")[0],i=[],s=[];for(const r of t.stops)i.push(r.value),Array.prototype.push.apply(s,B(r.color));return{kind:"ramp",stops:i,values:s,count:t.stops.length}}function N(e){if(!e.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const t=e.getVisualVariablesForType("opacity")[0],i=[],s=[];for(const r of t.stops)i.push(r.value),s.push(r.opacity);return{kind:"ramp",stops:i,values:s,count:t.stops.length}}class J{constructor(e,t,i,s){this._loadImagery=e,this._createStreamlinesMesh=t,this._timeExtent=s,this._rendererSettings=G(i)}get animated(){return this._rendererSettings.lineSpeed>0}get renderSettings(){return this._rendererSettings}areResourcesCompatible(e){let t=!0;return t=t&&e._loadImagery===this._loadImagery,t=t&&e._createStreamlinesMesh===this._createStreamlinesMesh,t=t&&e._rendererSettings.verticesPerLine===this._rendererSettings.verticesPerLine,t=t&&e._rendererSettings.segmentLength===this._rendererSettings.segmentLength,t=t&&e._rendererSettings.lineSpacing===this._rendererSettings.lineSpacing,t=t&&e._rendererSettings.density===this._rendererSettings.density,t=t&&e._rendererSettings.smoothing===this._rendererSettings.smoothing,t=t&&e._rendererSettings.velocityScale===this._rendererSettings.velocityScale,t=t&&e._rendererSettings.minWeightThreshold===this._rendererSettings.minWeightThreshold,t=t&&e._rendererSettings.minSpeedThreshold===this._rendererSettings.minSpeedThreshold,t=t&&e._rendererSettings.mergeLines===this._rendererSettings.mergeLines,t=t&&e._rendererSettings.velocityScale===this._rendererSettings.velocityScale,t=t&&e._rendererSettings.interpolate===this._rendererSettings.interpolate,t=t&&e._rendererSettings.lineColor.kind===this._rendererSettings.lineColor.kind,t=t&&e._rendererSettings.lineOpacity.kind===this._rendererSettings.lineOpacity.kind,t=t&&e._rendererSettings.lineRenderWidth.kind===this._rendererSettings.lineRenderWidth.kind,t&&this._rendererSettings.mergeLines&&(t=e._rendererSettings.lineCollisionWidth===this._rendererSettings.lineCollisionWidth),t&&e._timeExtent!==this._timeExtent&&(t=!(!Object(y["j"])(e._timeExtent)||!Object(y["j"])(this._timeExtent))&&e._timeExtent.equals(this._timeExtent)),t}async loadResources(e,t){const{extent:i,size:s}=e;Object(g["t"])(t);const r=await this._loadImagery(i,s[0],s[1],this._timeExtent,t),{vertexData:n,indexData:a}=await this._createStreamlinesMesh(this._rendererSettings,r,t);return new L(n,a,{lineColor:this._rendererSettings.lineColor,lineOpacity:this._rendererSettings.lineOpacity,lineRenderWidth:this._rendererSettings.lineRenderWidth})}}let Q=class extends n["a"]{constructor(){super(...arguments),this._loadImagery=(e,t,i,s,r)=>Object(c["b"])(this.layer,e,t,i,s,r),this._createStreamlinesMesh=(e,t,i)=>this.layer.createStreamlinesMesh({flowData:t,rendererSettings:e},{signal:i}),this.attached=!1,this.container=null,this.layer=null,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this._strategy||this._strategy.updating}attach(){const{layer:e}=this,t=()=>{this._loadImagery=(t,i,s,r,n)=>Object(c["b"])(e,t,i,s,r,n),this._updateVisualization()};"multidimensionalDefinition"in e?this.handles.add(Object(a["e"])(()=>e.multidimensionalDefinition,t)):this.handles.add([Object(a["e"])(()=>e.mosaicRule,t),Object(a["e"])(()=>e.renderingRule,t),Object(a["e"])(()=>e.definitionExpression,t)]),this.container=new f,this._strategy=new T({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container.removeAllChildren(),this.container=null,this.handles.removeAll()}update(e){e.stationary?this._strategy.update(e):this.layerView.requestUpdate()}hitTest(e){return new r["a"]({attributes:{},geometry:e.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){if("flow"!==this.layer.renderer.type)return;const e=new J(this._loadImagery,this._createStreamlinesMesh,this.layer.renderer,this.timeExtent);this.container.flowStyle=e,this.layerView.requestUpdate()}};Object(s["a"])([Object(o["b"])()],Q.prototype,"_strategy",void 0),Object(s["a"])([Object(o["b"])()],Q.prototype,"attached",void 0),Object(s["a"])([Object(o["b"])()],Q.prototype,"container",void 0),Object(s["a"])([Object(o["b"])()],Q.prototype,"layer",void 0),Object(s["a"])([Object(o["b"])()],Q.prototype,"layerView",void 0),Object(s["a"])([Object(o["b"])()],Q.prototype,"type",void 0),Object(s["a"])([Object(o["b"])()],Q.prototype,"updating",null),Object(s["a"])([Object(o["b"])()],Q.prototype,"timeExtent",void 0),Q=Object(s["a"])([Object(l["a"])("esri.views.2d.engine.flow.FlowView2D")],Q);const H=Q},ad73:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var s=i("b2b2"),r=i("c1da");async function n(e,t=e.popupTemplate){if(!Object(s["j"])(t))return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:n}=t,{objectIdField:a,typeIdField:o,globalIdField:l,relationships:c}=e;if(i.includes("*"))return["*"];const h=n?await Object(r["n"])(e):[],u=Object(r["j"])(e.fieldsIndex,[...i,...h]);return o&&u.push(o),u&&a&&e.fieldsIndex.has(a)&&-1===u.indexOf(a)&&u.push(a),u&&l&&e.fieldsIndex.has(l)&&-1===u.indexOf(l)&&u.push(l),c&&c.forEach(t=>{const{keyField:i}=t;u&&i&&e.fieldsIndex.has(i)&&-1===u.indexOf(i)&&u.push(i)}),u}function a(e,t){return e.popupTemplate?e.popupTemplate:Object(s["j"])(t)&&t.defaultPopupTemplateEnabled&&Object(s["j"])(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},aebc:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return re}));var s=i("a4ee"),r=i("8d60"),n=i("e92d"),a=i("f4cc"),o=i("477c"),l=i("3795"),c=i("59b2"),h=(i("b50f"),i("c120"),i("cea0"),i("d386")),u=i("870c"),d=i("566d"),f=i("b2b2"),p=i("9180"),m=i("a98b"),b=i("3b1a"),y=i("8c71"),g=i("f440"),x=i("e4b1");class w extends x["a"]{constructor(e,t,i,s,r,n=null){super(e,t,i,s,r),this.bitmap=new g["a"](n,null,null),this.bitmap.coordScale=[s,r],this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}setTransform(e,t){super.setTransform(e,t),this.bitmap.transforms.dvs=this.transforms.dvs}_createTransforms(){return{dvs:Object(y["b"])(),tileMat3:Object(y["b"])()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}var _=i("c84e"),v=i("6722");class O extends v["a"]{constructor(){super(...arguments),this.isCustomTilingScheme=!1}createTile(e){const t=this._getTileBounds(e),[i,s]=this._tileInfoView.tileInfo.size;return new w(e,t[0],t[3],i,s)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (tile)",brushes:[b["a"].raster],target:()=>this.children.map(e=>e.bitmap),drawPhase:_["c"].MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===_["c"].MAP&&super.doRender(e)}_getTileBounds(e){const t=this._tileInfoView.getTileBounds(Object(p["h"])(),e);if(this.isCustomTilingScheme&&e.world){const{tileInfo:i}=this._tileInfoView,s=Object(m["o"])(i.spatialReference);if(s){const{resolution:r}=i.lodAt(e.level),n=s/r%i.size[0],a=n?(i.size[0]-n)*r:0;t[0]-=a*e.world,t[2]-=a*e.world}}return t}}i("e06a");var j=i("9096"),S=i("4ae5"),P=i("3e27"),R=i("dff3"),M=i("218c"),k=i("9dee"),T=i("b4e0"),I=(i("3e7b"),i("018d")),V=(i("ae54"),i("07cd")),C=i("d302"),D=i("b2af"),z=i("3af1");const F=[0,0],E=n["a"].getLogger("esri.views.2d.layers.ImageryTileLayerView2D");let L=class extends j["a"]{constructor(){super(...arguments),this._emptyTilePixelBlock=null,this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=null,this.previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._isCustomTilingScheme=!1,this._globalUpdateRequested=!1,this.attached=!1,this.container=null,this.layer=null,this.timeExtent=null,this.redrawOrRefetch=Object(a["h"])((e,t)=>!this.previousLOD||this.layerView.suspended?Promise.resolve():e?this.doRefresh():this._redrawImage(t))}get useWebGLForProcessing(){var e;return null==(e=this._get("useWebGLForProcessing"))||e}set useWebGLForProcessing(e){this._set("useWebGLForProcessing",e)}get useProgressiveUpdate(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")}set useProgressiveUpdate(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();const t=this._getCacheSize(e);this._tileStrategy=new C["a"]({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.layerView.requestUpdate()}}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();const{extent:t,resolution:i,scale:s}=e.state,r=this._tileInfoView.getClosestInfoForScale(s);if(this.layer.raster){var n;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const e=this._srcResolutions[r.level],s=t.toJSON?t:z["a"].fromJSON(t);Object(M["h"])(this._blockCacheRegistryUrl,this._blockCacheRegistryId,s,i,e,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(n=this.previousLOD)?void 0:n.level)!==r.level&&(this.previousLOD=r,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1,this.layerView.requestUpdate()}));const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(e),this.layerView.requestUpdate()}get updating(){return this._fetchQueue.updating||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}attach(){Object(D["a"])().supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new I["a"](this.layerView.tileInfo,this.layerView.fullExtent);const e=this._computeFetchConcurrency();this._fetchQueue=new V["a"]({tileInfoView:this._tileInfoView,concurrency:e,process:(e,t)=>this._fetchTile1(e,t)});const t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new C["a"]({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}detach(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,Object(M["g"])(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}acquireTile(e){const t=this.container.createTile(e);return this._enqueueTileFetch(t),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}releaseTile(e){this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once("detach",()=>{e.destroy(),this.layerView.requestUpdate()}),this.layerView.requestUpdate()}createEmptyTilePixelBlock(e=null){const t=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&Object(f["j"])(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;e=e||this._tileInfoView.tileInfo.size;const[i,s]=e,r=new P["a"]({width:i,height:s,pixels:[new Uint8Array(i*s)],mask:new Uint8Array(i*s),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=r),r}_fetchTile1(e,t){const i=!Object(f["i"])(t)&&t.signal,s=this.canUseWebGLForProcessing(),{layerView:r}=this,n=!r.tileInfo.isWrappable&&Object(f["j"])(Object(T["e"])(r.view.spatialReference)),a={allowPartialFill:!0,datumTransformation:r.datumTransformation,interpolation:s?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:s,signal:Object(f["q"])(i),srcResolution:this._srcResolutions[e.level],timeExtent:r.timeExtent,tileInfo:r.tileInfo,disableWrapAround:n};return this.fetchTile(e,a)}_getCacheSize(e){return e?40:0}_initializeTileInfo(){const e=this.layerView.view.spatialReference,t=new S["a"]({x:this.layerView.fullExtent.xmin,y:this.layerView.fullExtent.ymax,spatialReference:e}),{scales:i,srcResolutions:s,isCustomTilingScheme:r}=Object(T["a"])(this.layer.rasterInfo,e),n=R["a"].create({spatialReference:e,size:512,scales:i});(0===n.origin.x||n.origin.x>t.x)&&(n.origin=t),this._isCustomTilingScheme=r,this.layerView.set("tileInfo",n),this._srcResolutions=null!=s?s:[]}_computeFetchConcurrency(){const{blockBoundary:e}=this.layer.rasterInfo.storageInfo,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}async _enqueueTileFetch(e,t){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key),{bandIds:s}=this.layer;let r=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){r=!1;try{await this._redrawImage(this._abortController&&this._abortController.signal)}catch(i){Object(a["l"])(i)&&E.error(i)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const n=this._tileInfoView.getTileCoords(F,e.key),o=this._tileInfoView.getTileResolution(e.key);await this.updateTileSource(e,{source:t,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:r,bandIds:s,coords:n,resolution:o}),e.once("attach",()=>this.layerView.requestUpdate()),this.container.addChild(e)}catch(i){Object(a["l"])(i)||E.error(i)}this.layerView.requestUpdate()}}async _redrawImage(e){if(0===this.container.children.length)return;await this.updatingHandles.addPromise(this.layer.updateRenderer()),this.layerView.hasTilingEffects?await this._updateGlobalSymbolizerParams(e):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const t=this.container.children.map(async e=>this.updateTileSymbolizerParameters(e,{local:this._symbolizerParams,global:this._globalSymbolizerParams}));await Object(a["i"])(t),this.container.requestRender()}async _updateGlobalSymbolizerParams(e){const t={srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:e},i=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,t);if(!i||!i.pixelBlock)return;const s=this.layer.symbolizer.generateWebGLParameters({pixelBlock:Object(k["h"])(i.pixelBlock,this.layer.bandIds),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds});!this.canUseWebGLForProcessing()&&s&&"stretch"===s.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(s.factor=s.factor.map(e=>255*e),s.outMin=Math.round(255*s.outMin),s.outMax=Math.round(255*s.outMax)),this._globalSymbolizerParams=s}_updateSymbolizerParams(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds})}_updateBlockCacheRegistry(e=!1){const{url:t,rasterInfo:i,raster:s}=this.layer,{multidimensionalDefinition:r}=this.layer.normalizeRasterFetchOptions({multidimensionalDefinition:this.layer.multidimensionalDefinition,timeExtent:this.layerView.timeExtent}),n=null!=i&&i.multidimensionalInfo?s.getSliceIndex(r):null,a=Object(M["d"])(t,n);if(a!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&Object(M["g"])(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=Object(M["f"])(a,this.layer.raster.rasterInfo),e){const e=this._tileInfoView.getClosestInfoForScale(this.layerView.view.scale),t=this._srcResolutions[e.level];Object(M["h"])(a,this._blockCacheRegistryId,this.layerView.view.extent,this.layerView.view.resolution,t,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=a}}async doRefresh(){await this.updatingHandles.addPromise(this.layer.updateRenderer()),this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset();const e=[];this._tileStrategy.tiles.forEach(t=>e.push(this._enqueueTileFetch(t))),await Object(a["i"])(e)}};Object(s["a"])([Object(c["b"])()],L.prototype,"_fetchQueue",void 0),Object(s["a"])([Object(c["b"])()],L.prototype,"_globalUpdateRequested",void 0),Object(s["a"])([Object(c["b"])()],L.prototype,"attached",void 0),Object(s["a"])([Object(c["b"])()],L.prototype,"container",void 0),Object(s["a"])([Object(c["b"])()],L.prototype,"layer",void 0),Object(s["a"])([Object(c["b"])()],L.prototype,"layerView",void 0),Object(s["a"])([Object(c["b"])()],L.prototype,"type",void 0),Object(s["a"])([Object(c["b"])()],L.prototype,"useWebGLForProcessing",null),Object(s["a"])([Object(c["b"])()],L.prototype,"useProgressiveUpdate",null),Object(s["a"])([Object(c["b"])()],L.prototype,"timeExtent",void 0),Object(s["a"])([Object(c["b"])()],L.prototype,"updating",null),L=Object(s["a"])([Object(h["a"])("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],L);var A=i("45a5");let G=class extends L{constructor(){super(...arguments),this.container=null,this.layer=null,this.type="raster"}attach(){super.attach(),this.container=new O(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme}detach(){super.detach(),this.container.removeAllChildren(),this.container=null}canUseWebGLForProcessing(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&Object(A["a"])(this.layer))}fetchTile(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}async updateTileSource(e,t){const{bandIds:i}=this.layer,s=this._getLayerInterpolation(),r=this.canUseWebGLForProcessing(),{source:n,symbolizerParams:a,globalSymbolizerParams:o,suspended:l,coords:c,resolution:h}=t,{bitmap:u}=e;if([u.x,u.y]=c,u.resolution=h,n&&Object(f["j"])(n)&&Object(f["j"])(n.pixelBlock)){const e={extent:n.extent,pixelBlock:n.pixelBlock};if(u.rawPixelData=e,r)u.source=n.pixelBlock,u.isRendereredSource=!1;else{const t=await this.layer.applyRenderer(e,"stretch"===(null==o?void 0:o.type)?o:null);u.source=t,u.isRendereredSource=!0}u.symbolizerParameters=r?a:null,r?u.transformGrid||(u.transformGrid=n.transformGrid):u.transformGrid=null}else{const e=this.createEmptyTilePixelBlock();u.source=e,u.symbolizerParameters=r?a:null,u.transformGrid=null}u.bandIds=r?i:null,u.width=this._tileInfoView.tileInfo.size[0],u.height=this._tileInfoView.tileInfo.size[1],u.interpolation=s,u.suspended=l,u.invalidateTexture()}async updateTileSymbolizerParameters(e,t){const{local:i,global:s}=t,{bandIds:r}=this.layer,n=this._getLayerInterpolation(),a=this.canUseWebGLForProcessing(),{bitmap:o}=e,{rawPixelData:l}=o;!a&&Object(f["j"])(l)?(o.source=await this.layer.applyRenderer(l,"stretch"===(null==s?void 0:s.type)?s:null),o.isRendereredSource=!0):(o.isRendereredSource&&Object(f["j"])(l)&&(o.source=l.pixelBlock),o.isRendereredSource=!1),o.symbolizerParameters=a?s||i:null,o.bandIds=a?r:null,o.interpolation=n,o.suspended=!1}_getLayerInterpolation(){const e=this.layer.renderer.type;if("raster-colormap"===e||"unique-value"===e||"class-breaks"===e)return"nearest";const{interpolation:t}=this.layer,{renderer:i}=this.layer;return"raster-stretch"===i.type&&null!=i.colorRamp?"bilinear"===t||"cubic"===t?"bilinear":"nearest":t}};Object(s["a"])([Object(c["b"])()],G.prototype,"container",void 0),Object(s["a"])([Object(c["b"])()],G.prototype,"layer",void 0),Object(s["a"])([Object(c["b"])()],G.prototype,"type",void 0),G=Object(s["a"])([Object(h["a"])("esri.views.2d.layers.imagery.ImageryTileView2D")],G);const U=G;var B=i("19db"),W=i("3bc3"),q=i("1c92"),N=i("0722");class J extends x["a"]{constructor(e,t,i,s,r,n=null){super(e,t,i,s,r),this.tileData=new N["a"](n),this.tileData.coordScale=[s,r],this.tileData.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.tileData.destroy(),this.tileData=null,this.stage=null}set stencilRef(e){this.tileData.stencilRef=e}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{dvs:Object(y["b"])(),tileMat3:Object(y["b"])()}}setTransform(e,t){super.setTransform(e,t);const i=t/(e.resolution*e.pixelRatio),s=this.transforms.tileMat3,[r,n]=this.tileData.offset,a=[this.x+r*t,this.y-n*t],[o,l]=e.toScreenNoRotation([0,0],a),{symbolTileSize:c}=this.tileData.symbolizerParameters,h=Math.round((this.width-this.tileData.offset[0])/c)*c,u=Math.round((this.height-this.tileData.offset[1])/c)*c,d=h/this.rangeX*i,f=u/this.rangeY*i;Object(q["l"])(s,d,0,0,0,f,0,o,l,1),Object(q["i"])(this.transforms.dvs,e.displayViewMat3,s),this.tileData.transforms.dvs=this.transforms.dvs}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}class Q extends v["a"]{constructor(){super(...arguments),this.isCustomTilingScheme=!1,this.symbolTypes=["triangle"]}createTile(e){const t=this._tileInfoView.getTileBounds(Object(p["h"])(),e),[i,s]=this._tileInfoView.tileInfo.size;return new J(e,t[0],t[3],i,s)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (vf tile)",brushes:[W["a"]],target:()=>this.children.map(e=>e.tileData),drawPhase:_["c"].MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===_["c"].MAP&&this.symbolTypes.forEach(t=>{e.renderPass=t,super.doRender(e)})}}let H=class extends L{constructor(){super(...arguments),this._handle=null,this.container=null,this.layer=null,this.type="rasterVF"}canUseWebGLForProcessing(){return!1}async fetchTile(e,t){t={...t,interpolation:"nearest",requestProjectedLocalDirections:!0};const i=await this.layer.fetchTile(e.level,e.row,e.col,t);return"vector-magdir"===this.layer.rasterInfo.dataType&&null!=i&&i.pixelBlock&&(i.pixelBlock=await this.layer.convertVectorFieldData(i.pixelBlock,t)),i}updateTileSource(e,t){const i=t.symbolizerParams,{tileData:s}=e;s.key=e.key,s.width=this._tileInfoView.tileInfo.size[0],s.height=this._tileInfoView.tileInfo.size[1];const{symbolTileSize:r}=i,{source:n}=t;if(s.offset=this._getTileSymbolOffset(s.key,r),Object(f["j"])(n)&&Object(f["j"])(n.pixelBlock)){const e={extent:n.extent,pixelBlock:n.pixelBlock};s.rawPixelData=e,s.symbolizerParameters=i,s.source=this._sampleVectorFieldData(n.pixelBlock,i,s.offset)}else{const e=[Math.round((this._tileInfoView.tileInfo[0]-s.offset[0])/r),Math.round((this._tileInfoView.tileInfo[1]-s.offset[1])/r)],t=this.createEmptyTilePixelBlock(e);s.source=t,s.symbolizerParameters=i}return s.invalidateVAO(),Promise.resolve(null)}updateTileSymbolizerParameters(e,t){var i;const s=t.local,{symbolTileSize:r}=s,{tileData:n}=e;n.offset=this._getTileSymbolOffset(n.key,r);const a=n.symbolizerParameters.symbolTileSize;return n.symbolizerParameters=s,Object(f["j"])(null==(i=n.rawPixelData)?void 0:i.pixelBlock)&&a!==r&&(n.source=this._sampleVectorFieldData(n.rawPixelData.pixelBlock,n.symbolizerParameters,n.offset)),Promise.resolve(null)}attach(){super.attach(),this.container=new Q(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=Object(o["e"])(()=>this.layer.renderer,e=>this._updateSymbolType(e))}detach(){super.detach(),this.container.removeAllChildren(),this._handle.remove(),this._handle=null}_getTileSymbolOffset(e,t){const i=e.col*this._tileInfoView.tileInfo.size[0]%t,s=e.row*this._tileInfoView.tileInfo.size[1]%t;return[i>t/2?t-i:-i,s>t/2?t-s:-s]}_sampleVectorFieldData(e,t,i){const{symbolTileSize:s}=t;return Object(B["g"])(e,"vector-uv",s,i)}_updateSymbolType(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}};Object(s["a"])([Object(c["b"])()],H.prototype,"container",void 0),Object(s["a"])([Object(c["b"])()],H.prototype,"layer",void 0),Object(s["a"])([Object(c["b"])()],H.prototype,"type",void 0),H=Object(s["a"])([Object(h["a"])("esri.views.2d.layers.imagery.VectorFieldTileView2D")],H);const Y=H;var X=i("ce50"),$=i("22f4"),K=i("ad73");const Z=e=>{let t=class extends e{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return this.projectFullExtent(this.view.spatialReference)}get hasTilingEffects(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}get datumTransformation(){return Object(T["b"])(Object(f["q"])(this.layer.fullExtent),this.view.spatialReference,!0)}supportsSpatialReference(e){return!!this.projectFullExtent(e)}projectFullExtent(e){const t=Object(f["q"])(this.layer.fullExtent),i=Object(T["b"])(t,e,!1);return Object(T["h"])(t,e,i)}async fetchPopupFeatures(e,t){const{layer:i}=this;if(!e)return Promise.reject(new X["a"]("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i}));const{popupEnabled:s}=i,n=Object(K["a"])(i,t);if(!s||!Object(f["j"])(n))throw new X["a"]("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:s,popupTemplate:n});const a=[],{value:o,magdirValue:l}=await i.identify(e,{timeExtent:this.timeExtent});let c="";if(o&&o.length){var h,u;c="imagery-tile"===i.type&&i.hasStandardTime()&&null!=o[0]?o.map(e=>i.getStandardTimeValue(e)).join(", "):o.join(", ");const e={ObjectId:0},t="Raster.ServicePixelValue";e[t]=this._formatAttributeValue(c,t);const s=null==(h=i.rasterInfo)||null==(u=h.attributeTable)?void 0:u.features;if(s&&s.length>0){const t=s.filter(e=>{const t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===c});if(t.length>0){const i=t[0];if(i)for(const t in i.attributes)if(i.attributes.hasOwnProperty(t)){const s=this._rasterFieldPrefix+t;e[s]=this._formatAttributeValue(i.attributes[t],s)}}}const n=i.rasterInfo.dataType;"vector-magdir"!==n&&"vector-uv"!==n||(e["Raster.Magnitude"]=null==l?void 0:l[0],e["Raster.Direction"]=null==l?void 0:l[1]);const d=new r["a"](this.fullExtent.clone(),null,e);d.layer=i,d.sourceLayer=d.layer,a.push(d)}return a}_formatAttributeValue(e,t){if("string"==typeof e){const i=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,s=this._getFieldInfo(i,t),r=s&&s.format;if(r){let t,i;return e.trim().indexOf(",")>-1?(t=",",i=t+" ",this._formatDelimitedString(e,t,i,r)):e.trim().indexOf(" ")>-1?(t=i=" ",this._formatDelimitedString(e,t,i,r)):this._formatNumberFromString(e,r)}}return e}_getFieldInfo(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let s;return e.some(e=>!(!e.fieldName||e.fieldName.toLowerCase()!==i&&e.fieldName.toLowerCase()!==i.replace(/ /g,"_"))&&(s=e,!0)),s}_formatDelimitedString(e,t,i,s){return e&&t&&i&&s?e.trim().split(t).map(e=>this._formatNumberFromString(e,s)).join(i):e}_formatNumberFromString(e,t){if(!e||!t)return e;const i=Number(e);return isNaN(i)?e:t.format(i)}};return Object(s["a"])([Object(c["b"])()],t.prototype,"layer",void 0),Object(s["a"])([Object(c["b"])($["a"])],t.prototype,"timeExtent",void 0),Object(s["a"])([Object(c["b"])()],t.prototype,"view",void 0),Object(s["a"])([Object(c["b"])()],t.prototype,"fullExtent",null),Object(s["a"])([Object(c["b"])()],t.prototype,"tileInfo",void 0),Object(s["a"])([Object(c["b"])({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=Object(s["a"])([Object(h["a"])("esri.views.layers.ImageryTileLayerView")],t),t};var ee=i("365a"),te=i("6c7a");const ie=n["a"].getLogger("esri.views.2d.layers.ImageryTileLayerView2D");let se=class extends(Z(Object(te["a"])(Object(d["a"])(ee["a"])))){constructor(){super(...arguments),this._useWebGLForProcessing=!0,this._useProgressiveUpdate=!0,this.subview=null}get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}update(e){this.subview.update(e),this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.handles.add([Object(l["d"])(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],(e,t,i)=>{const s="multidimensionalDefinition"===i,r="interpolation"===i&&("majority"===e||"majority"===t)&&Object(A["a"])(this.layer),n="renderer"===i&&t.type!==e.type;n&&this._updateSubview();const o=s||r||n;this.subview.redrawOrRefetch(o).catch(e=>{Object(a["l"])(e)||ie.error(e)}),this.notifyChange("updating")}),Object(o["e"])(()=>{var e;return null!=(e=this.layer.blendMode)?e:"normal"},e=>{this.subview.container.blendMode=e},o["d"]),Object(o["e"])(()=>{var e;return null!=(e=this.layer.effect)?e:null},e=>{this.subview.container.effect=e},o["d"]),Object(o["e"])(()=>this.timeExtent,()=>{this.subview.timeExtent=this.timeExtent,this.subview.redrawOrRefetch(!0).catch(e=>{Object(a["l"])(e)||ie.error(e)})},o["a"])],"attach")}detach(){var e;this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this._detachSubview(this.subview),null==(e=this.subview)||e.destroy(),this.subview=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}async hitTest(e,t){return[new r["a"]({attributes:{},geometry:e.clone()})]}doRefresh(){return this.subview.doRefresh()}_updateSubview(){const e="vector-field"===this.layer.renderer.type?"rasterVF":"flow"===this.layer.renderer.type?"flow":"raster";if(this.subview){var t;if(this.subview.type===e)return void this._attachSubview(this.subview);this._detachSubview(this.subview),null==(t=this.subview)||t.destroy(),this.subview=null}const{layer:i}=this;let s;s="rasterVF"===e?new Y({layer:i,layerView:this}):"flow"===e?new u["a"]({layer:i,layerView:this}):new U({layer:i,layerView:this}),"useWebGLForProcessing"in s&&(s.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in s&&(s.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in s&&(s.previousLOD=this.subview&&"previousLOD"in this.subview&&this.subview.previousLOD),this._attachSubview(s),this.subview=s,this.requestUpdate()}_attachSubview(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0),e.container.blendMode=this.layer.blendMode,e.container.effect=this.layer.effect)}_detachSubview(e){null!=e&&e.attached&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}};Object(s["a"])([Object(c["b"])()],se.prototype,"subview",void 0),Object(s["a"])([Object(c["b"])()],se.prototype,"useWebGLForProcessing",null),Object(s["a"])([Object(c["b"])()],se.prototype,"useProgressiveUpdate",null),se=Object(s["a"])([Object(h["a"])("esri.views.2d.layers.ImageryTileLayerView2D")],se);const re=se},b4e0:function(e,t,i){"use strict";i.d(t,"a",(function(){return Q})),i.d(t,"b",(function(){return _})),i.d(t,"c",(function(){return B})),i.d(t,"d",(function(){return G})),i.d(t,"e",(function(){return F})),i.d(t,"f",(function(){return A})),i.d(t,"g",(function(){return w})),i.d(t,"h",(function(){return D})),i.d(t,"i",(function(){return j})),i.d(t,"j",(function(){return v})),i.d(t,"k",(function(){return u})),i.d(t,"l",(function(){return N})),i.d(t,"m",(function(){return J}));i("e06a");var s=i("ce50"),r=i("b2b2"),n=i("8048"),a=i("9415"),o=i("8188"),l=i("3af1"),c=i("4ae5"),h=i("5996");function u(e,t,i){return!Object(o["b"])(e,t,i)}function d(e,t,i){const r=u(e,t,i);if(r&&!Object(o["f"])())throw new s["a"]("rasterprojectionhelper-project","projection engine is not loaded");return r}const f=function(e,t,i,s=0){if(1===i[0])return[0,0];let r=1,n=-1,a=1,o=-1;for(let b=0;b<e.length;b+=2)isNaN(e[b])||(r=r>e[b]?e[b]:r,n=n>e[b]?n:e[b],a=a>e[b+1]?e[b+1]:a,o=o>e[b+1]?o:e[b+1]);const{cols:l,rows:c}=t,h=(n-r)/l/i[0],u=(o-a)/c/i[1],d=2*s;let f=0,p=!1,m=[0,0];for(let b=0;b<l-3;b++){for(let t=0;t<c-3;t++){const i=b*c*2+2*t,s=(e[i]+e[i+4]+e[i+4*c]+e[i+4*c+4])/4,r=(e[i+1]+e[i+5]+e[i+4*c+1]+e[i+4*c+5])/4,n=Math.abs((s-e[i+2*c+2])/h),a=Math.abs((r-e[i+2*c+3])/u);if(n+a>f&&(f=n+a,m=[n,a]),d&&f>d){p=!0;break}}if(p)break}return m},p={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},m=32,b=4,y=b,g=new Map,x=new Map;async function w(){if(Object(o["f"])())return null;await Object(o["g"])()}function _(e,t,i){return d(e.spatialReference,t)?i?Object(o["d"])(t,e.spatialReference,e):Object(o["d"])(e.spatialReference,t,e):null}function v(e,t,i,s=null){const a=e.spatialReference;if(a.equals(t))return e;d(a,t,s);const c=i.center,h=new l["a"]({xmin:c.x-e.x/2,xmax:c.x+e.x/2,ymin:c.y-e.y/2,ymax:c.y+e.y/2,spatialReference:a}),u=Object(o["h"])(h,t,s);if(Object(r["i"])(u))return null;const f={x:u.xmax-u.xmin,y:u.ymax-u.ymin},p=F(t);if(Object(r["j"])(p)&&f.x>=p){const i=Object(n["d"])(a)/Object(n["d"])(t);f.x=e.x*i,f.y=e.y*i}return f}function O(e,t=.01){return Object(n["d"])(e)?t/Object(n["d"])(e):0}function j(e,t,i=null,s=!0){const n=e.spatialReference;if(n.equals(t))return e;d(n,t,i);const a=Object(o["h"])(e,t,i);if(!s||!a)return a;const l=E(n,!0),c=E(t,!0),h=O(n);return h&&Object(r["j"])(l)&&Object(r["j"])(c)&&(a.x>0&&Math.abs(e.x-l[0])<h?a.x-=c[1]-c[0]:a.x<0&&Math.abs(e.x-l[1])<h&&(a.x+=c[1]-c[0])),a}function S(e){const{inSR:t,outSR:i,datumTransformation:s,preferPE:n}=e;if(t.equals(i)){const{points:t}=I(e,null);return t}if(t.isWebMercator&&i.isWGS84||t.isWGS84&&i.isWebMercator)return M(e);if(d(t,i,s)&&n){if(t.isGeographic)return R(e);const i=k(t);if(Object(r["j"])(i))return R(e)}return P(e)}function P(e){const{points:t}=I(e,null),i=t.map(t=>new c["a"](t[0],t[1],e.inSR));return Object(o["h"])(i,e.outSR,e.datumTransformation).map(e=>e?[e.x,e.y]:[NaN,NaN])}function R(e){const{inSR:t,outSR:i,datumTransformation:s}=e,n=k(t),{points:o,mask:l}=I(e,n);if(!t.isGeographic){const e=t.wkid?a["a"].coordsys(t.wkid):a["a"].fromString(t.isGeographic?a["b"].PE_TYPE_GEOGCS:a["b"].PE_TYPE_PROJCS,t.wkt);a["c"].projToGeog(e,o.length,o)}if(Object(r["j"])(s)&&s.steps.length&&s.steps.forEach(e=>{const t=e.wkid?a["a"].geogtran(e.wkid):a["a"].fromString(a["b"].PE_TYPE_GEOGTRAN,e.wkt);a["d"].geogToGeog(t,o.length,o,null,e.isInverse?a["b"].PE_TRANSFORM_2_TO_1:a["b"].PE_TRANSFORM_1_TO_2)}),!i.isGeographic){const e=k(i,!0),t=Object(r["j"])(e)&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90];V(o,t);const s=i.wkid?a["a"].coordsys(i.wkid):a["a"].fromString(i.isGeographic?a["b"].PE_TYPE_GEOGCS:a["b"].PE_TYPE_PROJCS,i.wkt);a["c"].geogToProj(s,o.length,o)}let c=o;if(l&&o.length!==l.length){c=[];for(let e=0,t=0;e<l.length;e++)l[e]?c.push(o[t++]):c.push([NaN,NaN])}return c}function M(e){const{cols:t,rows:i,xres:s,yres:r,usePixelCenter:n,inSR:a,outSR:l}=e;let{xmin:h,ymax:u}=e;n&&(h+=s/2,u-=r/2);const d=[],f=[],p=Math.max(t,i);for(let b=0;b<p;b++){const e=h+s*Math.min(t,b),n=u-r*Math.min(i,b),p=Object(o["h"])(new c["a"]({x:e,y:n,spatialReference:a}),l);b<=t&&d.push(p.x),b<=i&&f.push(p.y)}const m=[];for(let o=0;o<t;o++)for(let e=0;e<i;e++)m.push([d[o],f[e]]);return m}function k(e,t=!1){let i=e.wkid||e.wkt;if(!i||e.isGeographic)return null;if(i=String(i),g.has(i)){const e=g.get(i);return t?null==e?void 0:e.gcs:null==e?void 0:e.pcs}const s=e.wkid?a["a"].coordsys(e.wkid):a["a"].fromString(e.isGeographic?a["b"].PE_TYPE_GEOGCS:a["b"].PE_TYPE_PROJCS,e.wkt),r=T(s,O(e,1e-4)),n=T(s,0,!0);return g.set(i,{pcs:r,gcs:n}),t?n:r}function T(e,t=0,i=!1){const s=a["f"].generate(e),r=i?e.horizonGcsGenerate():e.horizonPcsGenerate();if(null==r||!r.length)return null;let n=!1,o=r.find(e=>1===e.getInclusive()&&1===e.getKind());if(!o){if(o=r.find(e=>1===e.getInclusive()&&0===e.getKind()),!o)return null;n=!0}const l=s.isPannableRectangle(),c=o.getCoord();if(n)return{isEnvelope:n,isPannable:l,vertices:c,coef:null,bbox:[c[0][0]-t,c[0][1]-t,c[1][0]+t,c[1][1]+t]};let h=0;const u=[];let[d,f]=c[0],[p,m]=c[0];for(let a=0,b=c.length;a<b;a++){h++,h===b&&(h=0);const[e,t]=c[a],[i,s]=c[h];if(s===t)u.push([e,i,t,s,2]);else{const r=(i-e)/(s-t||1e-4),n=e-r*t;t<s?u.push([r,n,t,s,0]):u.push([r,n,s,t,1])}d=d<e?d:e,f=f<t?f:t,p=p>e?p:e,m=m>t?m:t}return{isEnvelope:!1,isPannable:l,vertices:c,coef:u,bbox:[d,f,p,m]}}function I(e,t){const i=[],{cols:s,rows:n,xres:a,yres:o,usePixelCenter:l}=e;let{xmin:c,ymax:h}=e;if(l&&(c+=a/2,h-=o/2),!Object(r["j"])(t)){for(let e=0;e<s;e++)for(let t=0;t<n;t++)i.push([c+a*e,h-o*t]);return{points:i}}const u=new Uint8Array(s*n);if(t.isEnvelope){const{bbox:[e,r,l,d]}=t;for(let f=0,p=0;f<s;f++){const s=c+a*f,m=t.isPannable||s>=e&&s<=l;for(let e=0;e<n;e++,p++){const t=h-o*e;m&&t>=r&&t<=d&&(i.push([s,t]),u[p]=1)}}return{points:i,mask:u}}const{coef:d}=t,f=[];for(let r=0;r<n;r++){const e=h-o*r,t=[],i=[];for(let r=0;r<d.length;r++){const[s,n,a,o,l]=d[r];if(e===a&&a===o)t.push(s),t.push(n),i.push(2),i.push(2);else if(e>=a&&e<=o){const r=s*e+n;t.push(r),i.push(l)}}let s=t;if(t.length>2){let e=2===i[0]?0:i[0],r=t[0];s=[];for(let n=1;n<i.length;n++)2===i[n]&&n!==i.length-1||(i[n]!==e&&(s.push(0===e?Math.min(r,t[n-1]):Math.max(r,t[n-1])),e=i[n],r=t[n]),n===i.length-1&&s.push(0===i[n]?Math.min(r,t[n]):Math.max(r,t[n])));s.sort((e,t)=>e-t)}else t[0]>t[1]&&(s=[t[1],t[0]]);f.push(s)}for(let r=0,p=0;r<s;r++){const e=c+a*r;for(let t=0;t<n;t++,p++){const s=h-o*t,r=f[t];if(2===r.length)e>=r[0]&&e<=r[1]&&(i.push([e,s]),u[p]=1);else if(r.length>2){let t=!1;for(let i=0;i<r.length;i+=2)if(e>=r[i]&&e<=r[i+1]){t=!0;break}t&&(i.push([e,s]),u[p]=1)}}}return{points:i,mask:u}}function V(e,t){const[i,s]=t;for(let r=0;r<e.length;r++){const t=e[r][1];(t<i||t>s)&&(e[r]=[NaN,NaN])}}function C(e){const t=F(e[0].spatialReference);if(e.length<2||!Object(r["j"])(t))return e[0];let{xmin:i,xmax:s,ymin:n,ymax:a}=e[0];for(let r=1;r<e.length;r++){const i=e[r];s=i.xmax+t*r,n=Math.min(n,i.ymin),a=Math.max(a,i.ymax)}return new l["a"]({xmin:i,xmax:s,ymin:n,ymax:a,spatialReference:e[0].spatialReference})}function D(e,t,i=null,s=!0){if(e.spatialReference.equals(t))return e;const n=A(e),a=F(e.spatialReference,!0),o=F(t);if(0===n||Object(r["i"])(a)||Object(r["i"])(o))return z(e,t,i,s);const c=e.clone().normalize();if(1===c.length&&e.xmax<a&&e.xmax-a/2>O(e.spatialReference)){const{xmin:t,xmax:i}=e;for(let s=0;s<=n;s++){const r=0===s?t:-a/2,o=s===n?i-a*s:a/2;c[s]=new l["a"]({xmin:r,xmax:o,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference})}}return C(c.map(e=>z(e,t,i,s)).filter(e=>!!e))}function z(e,t,i=null,s=!0,n=!0){const a=e.spatialReference;if(a.equals(t))return e;d(a,t,i);const l=Object(o["h"])(e,t,i);if(n&&t.isWebMercator&&l&&(l.ymax=Math.min(20037508.342787,l.ymax),l.ymin=Math.max(-20037508.342787,l.ymin),l.ymin>=l.ymax))return null;if(!s||!l)return l;const h=E(a,!0),u=E(t,!0);if(Object(r["i"])(h)||Object(r["i"])(u))return l;const f=O(a,.001),p=O(a,500),m=O(t,.001);if(Math.abs(l.xmin-u[0])<m&&Math.abs(l.xmax-u[1])<m){const s=Math.abs(e.xmin-h[0]),r=Math.abs(h[1]-e.xmax);if(s<f&&r>p){l.xmin=u[0];const s=[];s.push(new c["a"](e.xmax,e.ymin,a)),s.push(new c["a"](e.xmax,(e.ymin+e.ymax)/2,a)),s.push(new c["a"](e.xmax,e.ymax,a));const r=s.map(e=>j(e,t,i)).filter(e=>!isNaN(null==e?void 0:e.x)).map(e=>e.x);l.xmax=Math.max.apply(null,r)}if(r<f&&s>p){l.xmax=u[1];const s=[];s.push(new c["a"](e.xmin,e.ymin,a)),s.push(new c["a"](e.xmin,(e.ymin+e.ymax)/2,a)),s.push(new c["a"](e.xmin,e.ymax,a));const r=s.map(e=>j(e,t,i)).filter(e=>!isNaN(null==e?void 0:e.x)).map(e=>e.x);l.xmin=Math.min.apply(null,r)}}else{const e=O(t,.001);Math.abs(l.xmin-u[0])<e&&(l.xmin=u[0]),Math.abs(l.xmax-u[1])<e&&(l.xmax=u[1])}return l}function F(e,t=!1){const i=t?20037508.342787:20037508.342788905;return e.isWebMercator?2*i:e.wkid&&e.isGeographic?360:2*p[e.wkid]||null}function E(e,t=!1){if(e.isGeographic)return[-180,180];const i=F(e,t);return Object(r["j"])(i)?[-i/2,i/2]:null}function L(e,t,i,s){let r=(e-t)/i;return r-Math.floor(r)!=0?r=Math.floor(r):s&&(r-=1),r}function A(e,t=!1){const i=F(e.spatialReference);if(!Object(r["j"])(i))return 0;const s=t?0:-i/2,n=O(e.spatialReference),a=!t&&Math.abs(e.xmax-i/2)<n?i/2:e.xmax,o=!t&&Math.abs(e.xmin+i/2)<n?-i/2:e.xmin;return L(a,s,i,!0)-L(o,s,i,!1)}function G(e){const t=e.storageInfo.origin.x,i=F(e.spatialReference,!0);if(!Object(r["j"])(i))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const s=i/2,{nativePixelSize:n,storageInfo:a,extent:o}=e,{maximumPyramidLevel:l,blockWidth:c,pyramidScalingFactor:h}=a;let u=n.x;const d=[],f=Object(r["j"])(e.transform)&&"gcs-shift"===e.transform.type,p=t+(f?0:s),m=f?i-t:s-t;for(let r=0;r<=l;r++){const e=(o.xmax-t)/u/c,i=e-Math.floor(e)==0?e:Math.ceil(e),s=m/u/c,r=s-Math.floor(s)==0?s:Math.ceil(s),n=Math.floor(p/u/c),a=Math.round(p/u)%c,l=(c-Math.round(m/u)%c)%c;d.push({resolutionX:u,blockWidth:c,datsetColumnCount:i,worldColumnCountFromOrigin:r,leftMargin:a,rightPadding:l,originColumnOffset:n}),u*=h}return{originX:t,halfWorldWidth:s,pyramidsInfo:d,hasGCSSShiftTransform:f}}function U(e){if(!e||e.isGeographic)return e;const t=String(e.wkid||e.wkt);let i;return x.has(t)?i=x.get(t):(i=(e.wkid?a["a"].coordsys(e.wkid):a["a"].fromString(a["b"].PE_TYPE_PROJCS,e.wkt)).getGeogcs().getCode(),x.set(t,i)),new h["a"]({wkid:i})}function B(e){const t=e.isAdaptive&&null==e.spacing;let i=e.spacing||[m,m],s=W(e),n={cols:s.size[0]+1,rows:s.size[1]+1};const a=s.outofBoundPointCount>0&&s.outofBoundPointCount<s.offsets.length/2;let o=s.outofBoundPointCount===s.offsets.length/2||t&&a?[0,0]:f(s.offsets,n,i,y);const l=(o[0]+o[1])/2,c=e.projectedExtent.spatialReference,h=e.srcBufferExtent.spatialReference;if(t&&(a||l>y)&&(u(c,h,e.datumTransformation)&&(c.isGeographic||Object(r["j"])(k(c))),i=[b,b],s=W({...e,spacing:i}),n={cols:s.size[0]+1,rows:s.size[1]+1},o=f(s.offsets,n,i,y)),s.error=o,i[0]>1&&(s.coefficients=q(s.offsets,n,a)),e.includeGCSGrid&&!c.isGeographic&&!c.isWebMercator)if(h.isGeographic)s.gcsGrid={offsets:s.offsets,coefficients:s.coefficients,spacing:i};else{const t=k(c);if(Object(r["j"])(t)&&!t.isEnvelope){const t=U(c),r=D(e.projectedExtent,t),{offsets:o}=W({...e,srcBufferExtent:r,spacing:i}),l=q(o,n,a);s.gcsGrid={offsets:o,coefficients:l,spacing:i}}}return s}function W(e){const{projectedExtent:t,srcBufferExtent:i,pixelSize:s,datumTransformation:n,rasterTransform:a}=e,o=t.spatialReference,l=i.spatialReference;d(o,l);const{xmin:h,ymin:u,xmax:f,ymax:p}=t,y=F(l),g=Object(r["j"])(y)&&(e.hasWrapAround||"gcs-shift"===(null==a?void 0:a.type)),x=e.spacing||[m,m],w=x[0]*s.x,_=x[1]*s.y,v=1===x[0],j=Math.ceil((f-h)/w-.1/x[0])+(v?0:1),P=Math.ceil((p-u)/_-.1/x[1])+(v?0:1),R=S({cols:j,rows:P,xmin:h,ymax:p,xres:w,yres:_,inSR:o,outSR:l,datumTransformation:n,preferPE:x[0]<=b,usePixelCenter:v}),M=[];let k,T=0;const I=v?-1:NaN,{xmin:V,xmax:C,ymax:D,width:z,height:E}=i,L=O(l,500);for(let r=0;r<j;r++){const e=[];for(let t=0;t<P;t++){let i=R[r*P+t];if(g&&i[0]>C&&i[0]>y/2-L&&(i[0]-=y),!i||isNaN(i[0])||isNaN(i[1]))M.push(I),M.push(I),e.push(null),T++;else{if(a){const e=a.inverseTransform(new c["a"]({x:i[0],y:i[1],spatialReference:l}));i=[e.x,e.y]}e.push(i),r>0&&g&&k[t]&&i[0]<k[t][0]&&(i[0]+=y),M.push((i[0]-V)/z),M.push((D-i[1])/E)}}k=e}return{offsets:M,error:null,coefficients:null,outofBoundPointCount:T,spacing:x,size:v?[j,P]:[j-1,P-1]}}function q(e,t,i){const{cols:s,rows:r}=t,n=new Float32Array((s-1)*(r-1)*2*6),a=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),o=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<s-1;l++){for(let t=0;t<r-1;t++){let i=l*r*2+2*t;const c=e[i],h=e[i+1],u=e[i+2],d=e[i+3];i+=2*r;const f=e[i],p=e[i+1],m=e[i+2],b=e[i+3];let y=0,g=12*(t*(s-1)+l);for(let e=0;e<3;e++)n[g++]=a[y++]*c+a[y++]*u+a[y++]*m;y=0;for(let e=0;e<3;e++)n[g++]=a[y++]*h+a[y++]*d+a[y++]*b;y=0;for(let e=0;e<3;e++)n[g++]=o[y++]*c+o[y++]*f+o[y++]*m;y=0;for(let e=0;e<3;e++)n[g++]=o[y++]*h+o[y++]*p+o[y++]*b}if(i)for(let e=0;e<n.length;e++)isNaN(n[e])&&(n[e]=-1)}return n}function N(e){const t=e.clone().normalize();return 1===t.length?t[0]:C(t)}function J(e,t,i){const{storageInfo:s,pixelSize:n}=t;let a,o=!1;const{pyramidResolutions:l}=s;if(Object(r["j"])(l)&&l.length){const s=(e.x+e.y)/2,r=l[l.length-1],h=(r.x+r.y)/2,u=(n.x+n.y)/2;if(s<=u)a=0;else if(s>=h)a=l.length,o=s/h>8;else{let e,t=u;for(let r=1;r<=l.length;r++){if(e=(l[r-1].x+l[r-1].y)/2,s<=e){s===e?a=r:"down"===i?(a=r-1,o=s/t>8):a="up"===i||s-t>e-s||s/t>2?r:r-1;break}t=e}}const d=0===a?n:l[a-1];return{pyramidLevel:a,pyramidResolution:new c["a"]({x:d.x,y:d.y,spatialReference:t.spatialReference}),excessiveReading:o}}const h=Math.log(e.x/n.x)/Math.LN2,u=Math.log(e.y/n.y)/Math.LN2,d=t.storageInfo.maximumPyramidLevel||0;a="down"===i?Math.floor(Math.min(h,u)):"up"===i?Math.ceil(Math.max(h,u)):Math.round((h+u)/2),a<0?a=0:a>d&&(o=a>d+3,a=d);const f=2**a;return{pyramidLevel:a,pyramidResolution:new c["a"]({x:f*t.nativePixelSize.x,y:f*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:o}}function Q(e,t,i=512,s=!0){const{extent:r,spatialReference:a,pixelSize:o}=e,l=v(new c["a"]({x:o.x,y:o.y,spatialReference:a}),t,r);if(null==l)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const h=(l.x+l.y)/2,u=Object(n["d"])(t),d=h*u*96*39.37,f=t.isGeographic?256/i*295828763.7958547:256/i*591657527.591555;let p="vector-magdir"===e.dataType||"vector-uv"===e.dataType;const m=D(r,t);p||s&&(t.isGeographic||t.isWebMercator)&&(p=m.xmin*m.xmax<0);let b,y=d;const g=1.001;if(p){y=f;const e=t.isGeographic?1341104507446289e-21:.29858214164761665,i=e*(96*u*39.37),s=t.isGeographic?4326:3857;b=v(new c["a"]({x:e,y:e,spatialReference:{wkid:s}}),a,m),b.x*=y/i,b.y*=y/i}else{b={x:o.x,y:o.y};const t=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2);let i=0;for(;y<f*(g/2)&&i<t;)i++,y*=2,b.x*=2,b.y*=2;Math.max(y,f)/Math.min(y,f)<=g&&(y=f)}const x=[y],w=[{x:b.x,y:b.y}],_=70.5310735,O=Math.min(_,d)/g;for(;y>=O;)y/=2,b.x/=2,b.y/=2,x.push(y),w.push({x:b.x,y:b.y});return{projectedPixelSize:l,scales:x,srcResolutions:w,isCustomTilingScheme:!p}}},e4b1:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var s=i("1c92"),r=i("7c4b"),n=i("ae54");class a extends r["a"]{constructor(e,t,i,s,r,a=s,o=r){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new n["a"](e),this.x=t,this.y=i,this.width=s,this.height=r,this.rangeX=a,this.rangeY=o}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e,t){const i=t/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[n,a]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,l=this.height/this.rangeY*i;Object(s["l"])(r,o,0,0,0,l,0,n,a,1),Object(s["i"])(this.transforms.dvs,e.displayViewMat3,r)}}}}]);